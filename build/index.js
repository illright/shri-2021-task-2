"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t,e=function(t,e,n,o,i){var r,s;if(void 0===o)o=0;else if((o|=0)<0||o>=t.length)throw new RangeError("invalid lower bound");if(void 0===i)i=t.length-1;else if((i|=0)<o||i>=t.length)throw new RangeError("invalid upper bound");for(;o<=i;)if((s=+n(t[r=o+(i-o>>>1)],e,r,t))<0)o=r+1;else{if(!(s>0))return r;i=r-1}return~o};function n(t,e){return t.startAt-e.startAt}function o(t,e){return t[0]-e[0]}function i(t,e){return e[1]-t[1]}function r(e,n){return n<e.startAt?t.Earlier:n>=e.finishAt?t.Later:t.Within}function s(t){return"object"==typeof t&&"id"in t&&"type"in t}function a(t){return s(t)?t.id:t}!function(t){t[t.Later=-1]="Later",t[t.Within=0]="Within",t[t.Earlier=1]="Earlier"}(t||(t={}));class u{constructor(){this.upTo100=0,this.upTo500=0,this.upTo1000=0,this.moreThan1000=0}countInCommit(t,e){let n=0;for(const o of t.summaries){const t=e.get(a(o));n+=t.added+t.removed}n<=100?this.upTo100++:n<=500?this.upTo500++:n<=1e3?this.upTo1000++:this.moreThan1000++}getTotal(){return this.upTo100+this.upTo500+this.upTo1000+this.moreThan1000}}function l(t,e,n,o,i){var r,a;for(const r of t.friends)s(r)&&(e.set(r.id,r),l(r,e,n,o,i));const u=(null!==(r=null==t?void 0:t.commits)&&void 0!==r?r:[]).filter(s);n.push(...u),u.forEach((t=>c(t,e,n,o,i)));const d=(null!==(a=null==t?void 0:t.comments)&&void 0!==a?a:[]).filter(s);o.push(...d),d.forEach((t=>f(t,e,n,o,i)))}function c(t,e,n,o,i){s(t.author)&&(e.set(t.author.id,t.author),l(t.author,e,n,o,i));for(const r of t.summaries)s(r)&&(i.set(r.id,r),d(r,e,n,o,i))}function f(t,e,n,o,i){s(t.author)&&(e.set(t.author.id,t.author),l(t.author,e,n,o,i));for(const r of t.likes)s(r)&&(e.set(r.id,r),l(r,e,n,o,i))}function d(t,e,n,o,i){var r;const a=(null!==(r=null==t?void 0:t.comments)&&void 0!==r?r:[]).filter(s);o.push(...a),a.forEach((t=>f(t,e,n,o,i)))}function m(t,e,n,o,i){for(const r of t.dependencies)s(r)&&m(r,e,n,o,i);for(const r of t.issues)s(r)&&h(r,e,n,o,i);const r=t.commits.filter(s);n.push(...r),r.forEach((t=>c(t,e,n,o,i)))}function h(t,e,n,o,i){const r=t.comments.filter(s);o.push(...r),r.forEach((t=>f(t,e,n,o,i))),s(null==t?void 0:t.resolvedBy)&&(e.set(t.resolvedBy.id,t.resolvedBy),l(t.resolvedBy,e,n,o,i))}function p(t,e){return{alias:"leaders",data:{title:"Больше всего коммитов",subtitle:t.name,emoji:"👑",users:e}}}const v={one:"голос",two:"голоса",five:"голосов"},T={one:"коммит",two:"коммита",five:"коммитов"},g={one:"с прошлого спринта",two:"с прошлого спринта",five:"с прошлого спринта"};function w(t,e,n=!1){const o=n&&t>0?`+${t}`:t.toString();return(t=Math.abs(t))%10==1&&t%100-1!=10?`${o} ${e.one}`:t%10>=2&&t%10<=4&&t%100-t%10!=10?`${o} ${e.two}`:`${o} ${e.five}`}function y(t,e,n){const o=[...e.entries()];return o.sort(i),{alias:"vote",data:{title:"Самый 🔎 внимательный разработчик",subtitle:t.name,emoji:"🔎",users:o.map((([t,e])=>{const o=n.get(t);return{id:t,name:o.name,avatar:o.avatar,valueText:w(e,v)}}))}}}function b(t,e,n,i){return[...n.entries()].sort(o),{alias:"chart",data:{title:"Коммиты",subtitle:t.name,values:e.map((e=>{var o;const i={title:e.id.toString(),value:null!==(o=n.get(e.id))&&void 0!==o?o:0,hint:e.name};return e.id===t.id&&(i.active=!0),i})),users:i}}}function E(t,e,n){const o=e.getTotal(),i=o-n.getTotal();return{alias:"diagram",data:{title:"Размер коммитов",subtitle:t.name,totalText:w(o,T),differenceText:w(i,g,true),categories:[["> 1001 строки","moreThan1000"],["501 — 1000 строк","upTo1000"],["101 — 500 строк","upTo500"],["1 — 100 строк","upTo100"]].map((([t,o])=>({title:t,valueText:w(e[o],T),differenceText:w(e[o]-n[o],T,true)})))}}}function x(t,e){return{alias:"activity",data:{title:"Коммиты",subtitle:t.name,data:{mon:e[1],tue:e[2],wed:e[3],thu:e[4],fri:e[5],sat:e[6],sun:e[0]}}}}function M(e,n){return r(n,e)===t.Within}exports.prepareData=function(t,{sprintId:o}){var s,v,T;let g,w;const A=new Map,$=[],j=[],C=new Map,S=[],B=new Map;for(const e of t)"User"===e.type?(A.set(e.id,e),l(e,A,j,$,C)):"Comment"===e.type?($.push(e),f(e,A,j,$,C)):"Commit"===e.type?(j.push(e),c(e,A,j,$,C)):"Summary"===e.type?(C.set(e.id,e),d(e,A,j,$,C)):"Sprint"===e.type?(e.id===o&&(g=e),e.id===o-1&&(w=e),S.push(e),B.set(e.id,e)):"Project"===e.type?m(e,A,j,$,C):h(e,A,j,$,C);S.sort(n);const I=new Map;for(const t of $)if(M(t.createdAt,g)){const e=t.likes.length,n=a(t.author);I.set(n,(null!==(s=I.get(n))&&void 0!==s?s:0)+e)}const W=new Map,D=new Map,L=new u,k=new u,P=new Array(7).fill(null).map((()=>new Array(24).fill(0)));for(const t of j){if(M(t.timestamp,g)){const e=a(t.author);W.set(e,(null!==(v=W.get(e))&&void 0!==v?v:0)+1),L.countInCommit(t,C);const n=new Date(t.timestamp);P[n.getDay()][n.getHours()]++}M(t.timestamp,w)&&k.countInCommit(t,C);const n=e(S,t.timestamp,r);n>=0&&D.set(S[n].id,(null!==(T=D.get(S[n].id))&&void 0!==T?T:0)+1)}const R=[...W.entries()];R.sort(i);const _=R.map((([t,e])=>{const n=A.get(t);return{id:t,name:n.name,avatar:n.avatar,valueText:e.toString()}}));return[p(g,_),y(g,I,A),b(g,S,D,_),E(g,L,k),x(g,P)]};
//# sourceMappingURL=index.js.map
