var app=function(t){"use strict";var e,n=function(t,e,n,o,i){var r,a;if(void 0===o)o=0;else if((o|=0)<0||o>=t.length)throw new RangeError("invalid lower bound");if(void 0===i)i=t.length-1;else if((i|=0)<o||i>=t.length)throw new RangeError("invalid upper bound");for(;o<=i;)if((a=+n(t[r=o+(i-o>>>1)],e,r,t))<0)o=r+1;else{if(!(a>0))return r;i=r-1}return~o};function o(t,e){return t.startAt-e.startAt}function i(t,e){return t[0]-e[0]}function r(t,e){return e[1]-t[1]}function a(t,n){return n<t.startAt?e.Earlier:n>=t.finishAt?e.Later:e.Within}function s(t){return"object"==typeof t&&"id"in t&&"type"in t}function u(t){return s(t)?t.id:t}!function(t){t[t.Later=-1]="Later",t[t.Within=0]="Within",t[t.Earlier=1]="Earlier"}(e||(e={}));class l{constructor(){this.upTo100=0,this.upTo500=0,this.upTo1000=0,this.moreThan1000=0}countInCommit(t,e){let n=0;for(const o of t.summaries){const t=e.get(u(o));n+=t.added+t.removed}n<=100?this.upTo100++:n<=500?this.upTo500++:n<=1e3?this.upTo1000++:this.moreThan1000++}getTotal(){return this.upTo100+this.upTo500+this.upTo1000+this.moreThan1000}}function c(t,e,n,o,i){var r,a;for(const r of t.friends)s(r)&&(e.set(r.id,r),c(r,e,n,o,i));const u=(null!==(r=null==t?void 0:t.commits)&&void 0!==r?r:[]).filter(s);n.push(...u),u.forEach((t=>f(t,e,n,o,i)));const l=(null!==(a=null==t?void 0:t.comments)&&void 0!==a?a:[]).filter(s);o.push(...l),l.forEach((t=>d(t,e,n,o,i)))}function f(t,e,n,o,i){s(t.author)&&(e.set(t.author.id,t.author),c(t.author,e,n,o,i));for(const r of t.summaries)s(r)&&(i.set(r.id,r),m(r,e,n,o,i))}function d(t,e,n,o,i){s(t.author)&&(e.set(t.author.id,t.author),c(t.author,e,n,o,i));for(const r of t.likes)s(r)&&(e.set(r.id,r),c(r,e,n,o,i))}function m(t,e,n,o,i){var r;const a=(null!==(r=null==t?void 0:t.comments)&&void 0!==r?r:[]).filter(s);o.push(...a),a.forEach((t=>d(t,e,n,o,i)))}function h(t,e,n,o,i){for(const r of t.dependencies)s(r)&&h(r,e,n,o,i);for(const r of t.issues)s(r)&&p(r,e,n,o,i);const r=t.commits.filter(s);n.push(...r),r.forEach((t=>f(t,e,n,o,i)))}function p(t,e,n,o,i){const r=t.comments.filter(s);o.push(...r),r.forEach((t=>d(t,e,n,o,i))),s(null==t?void 0:t.resolvedBy)&&(e.set(t.resolvedBy.id,t.resolvedBy),c(t.resolvedBy,e,n,o,i))}function v(t,e){return{alias:"leaders",data:{title:"Больше всего коммитов",subtitle:t.name,emoji:"👑",users:e}}}const T={one:"голос",two:"голоса",five:"голосов"},g={one:"коммит",two:"коммита",five:"коммитов"},w={one:"с прошлого спринта",two:"с прошлого спринта",five:"с прошлого спринта"};function y(t,e,n=!1){const o=n&&t>0?`+${t}`:t.toString();return(t=Math.abs(t))%10==1&&t%100-1!=10?`${o} ${e.one}`:t%10>=2&&t%10<=4&&t%100-t%10!=10?`${o} ${e.two}`:`${o} ${e.five}`}function b(t,e,n){const o=[...e.entries()];return o.sort(r),{alias:"vote",data:{title:"Самый 🔎 внимательный разработчик",subtitle:t.name,emoji:"🔎",users:o.map((([t,e])=>{const o=n.get(t);return{id:t,name:o.name,avatar:o.avatar,valueText:y(e,T)}}))}}}function E(t,e,n,o){return[...n.entries()].sort(i),{alias:"chart",data:{title:"Коммиты",subtitle:t.name,values:e.map((e=>{var o;const i={title:e.id.toString(),value:null!==(o=n.get(e.id))&&void 0!==o?o:0,hint:e.name};return e.id===t.id&&(i.active=!0),i})),users:o}}}function M(t,e,n){const o=e.getTotal(),i=o-n.getTotal();return{alias:"diagram",data:{title:"Размер коммитов",subtitle:t.name,totalText:y(o,g),differenceText:y(i,w,true),categories:[["> 1001 строки","moreThan1000"],["501 — 1000 строк","upTo1000"],["101 — 500 строк","upTo500"],["1 — 100 строк","upTo100"]].map((([t,o])=>({title:t,valueText:y(e[o],g),differenceText:y(e[o]-n[o],g,true)})))}}}function A(t,e){return{alias:"activity",data:{title:"Коммиты",subtitle:t.name,data:{mon:e[1],tue:e[2],wed:e[3],thu:e[4],fri:e[5],sat:e[6],sun:e[0]}}}}function $(t,n){return a(n,t)===e.Within}return t.prepareData=function(t,{sprintId:e}){var i,s,T;let g,w;const y=new Map,x=[],j=[],C=new Map,S=[],B=new Map;for(const n of t)"User"===n.type?(y.set(n.id,n),c(n,y,j,x,C)):"Comment"===n.type?(x.push(n),d(n,y,j,x,C)):"Commit"===n.type?(j.push(n),f(n,y,j,x,C)):"Summary"===n.type?(C.set(n.id,n),m(n,y,j,x,C)):"Sprint"===n.type?(n.id===e&&(g=n),n.id===e-1&&(w=n),S.push(n),B.set(n.id,n)):"Project"===n.type?h(n,y,j,x,C):p(n,y,j,x,C);S.sort(o);const I=new Map;for(const t of x)if($(t.createdAt,g)){const e=t.likes.length,n=u(t.author);I.set(n,(null!==(i=I.get(n))&&void 0!==i?i:0)+e)}const W=new Map,D=new Map,L=new l,k=new l,P=new Array(7).fill(null).map((()=>new Array(24).fill(0)));for(const t of j){if($(t.timestamp,g)){const e=u(t.author);W.set(e,(null!==(s=W.get(e))&&void 0!==s?s:0)+1),L.countInCommit(t,C);const n=new Date(t.timestamp);P[n.getDay()][n.getHours()]++}$(t.timestamp,w)&&k.countInCommit(t,C);const e=n(S,t.timestamp,a);e>=0&&D.set(S[e].id,(null!==(T=D.get(S[e].id))&&void 0!==T?T:0)+1)}const R=[...W.entries()];R.sort(r);const _=R.map((([t,e])=>{const n=y.get(t);return{id:t,name:n.name,avatar:n.avatar,valueText:e.toString()}}));return[v(g,_),b(g,I,y),E(g,S,D,_),M(g,L,k),A(g,P)]},Object.defineProperty(t,"__esModule",{value:!0}),t}({});
//# sourceMappingURL=index.js.map
